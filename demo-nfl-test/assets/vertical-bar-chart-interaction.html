<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>D3 Nice Axes</title>
    <script src="https://d3js.org/d3.v7.js"></script>
    <!-- Load revisit-communicate to be able to send data to reVISit -->
    <script src="../../revisitUtilities/revisit-communicate.js"></script>
  </head>

  <body>
    <svg></svg>
  </body>

  <script>
    // Get data from the config file
    Revisit.onDataReceive((data) => {
      const low_2 = data["barData"];
      const taskID = "barChart";
      const loc = "belowStimulus";

      var margin = { top: 20, right: 20, bottom: 60, left: 60 },
        width = 400 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;

      var svg = d3
        .select("body")
        .append("svg")
        .attr("height", height + margin.top + margin.bottom)
        .attr("width", width + margin.left + margin.right)
        .attr("transform", "translate(100,0)");

      var chart = svg
        .append("g")
        .attr("width", width)
        .attr("height", height)
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      //drawing x-label
      svg
        .append("text")
        .text("Team")
        .attr(
          "transform",
          "translate(" + (width + 50) / 2 + "," + (height + 50) + ")",
        );
      //drawing y-label
      svg
        .append("text")
        .text("Score")
        .attr(
          "transform",
          "translate(20" + "," + (height + 50) / 2 + ") rotate(-90)",
        );

      //drawing x scale
      var xscale = d3
        .scaleBand()
        .domain(low_2.map((d) => d.team))
        .range([0, width])
        .padding(0.2);

      // drawing y scale
      var yscale = d3
        .scaleLinear()
        .domain([0, d3.max(low_2, (d) => Number(d.score)) + 10])
        .range([height, 0]);

      //drawing x-axis
      chart
        .append("g")
        .call(d3.axisBottom(xscale))
        .attr("transform", "translate(0," + height + ")");
        
      //drawing y-axis
      chart.append("g").call(d3.axisLeft(yscale));
      chart
        .selectAll("rect")
        .data(low_2)
        .enter()
        .append("rect")
        .attr("width", xscale.bandwidth)
        .attr("height", (d) => height - yscale(d.score))
        .attr("x", (d) => xscale(d.team))
        .attr("y", (d) => yscale(d.score))
        .attr("fill", "#ffffff")
        .attr("stroke-width", 1)
        .attr("stroke", "black")

        // Post answer from the html to reVISit platform
        .on("click", (e, d) => {
          Revisit.postAnswers({
            [taskID]: d,
          });
        });

      svg
        .append("g")
        .attr(
          "transform",
          "translate(" + padding + "," + (height + padding) + ")",
        )
        .call(xAxis);
    });
  </script>
</html>
